name: Flutter CI

on:
push:
branches:
- main
pull_request:
branches:
- main

jobs:
build:
runs-on: ubuntu-latest

steps:
  - name: Checkout repository
    uses: actions/checkout@v4

  - name: Setup Flutter SDK
    uses: subosito/flutter-action@v2
    with:
      flutter-version: 'latest'
      channel: 'stable'

  - name: Disable Flutter analytics
    run: flutter config --no-analytics

  - name: Install dependencies
    run: flutter pub get

  - name: Run tests
    run: flutter test --no-sound-null-safety

  - name: Build Android (APK & AAB)
    run: |
      flutter build apk --release
      flutter build appbundle --release

  - name: Build iOS
    run: flutter build ios --no-codesign
